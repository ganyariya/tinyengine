# CLAUDE.md

このファイルは、このリポジトリでコードを操作する際にClaude Code (claude.ai/code) にガイダンスを提供します。

## 重要：Claude Codeは日本語で回答してください

このプロジェクトは日本語の教育プロジェクトのため、Claude Codeは常に日本語で回答し、日本語でコメントや説明を記述してください。

## プロジェクト概要

**TinyEngine** は Go 言語で作成する教育的な小さなゲームエンジンです。クリーンなテスト駆動開発を通じてゲームエンジンアーキテクチャを教えることを目的としています。SOLID原則に従い、学習効果を最大化するための段階的な実装を重視しています。

## 技術スタック

- **言語**: Go 1.19+
- **描画**: OpenGL 4 Core Profile + GLFW
- **数学ライブラリ**: mathgl
- **テストフレームワーク**: Go標準testing + testify
- **オーディオ**: Beep（後期段階で追加）

## 開発コマンド

仕様に基づき、実装後は以下のコマンドを使用します：

```bash
# テスト実行
go test ./... -v -race -coverprofile=coverage.out

# リント実行
golangci-lint run

# ビルド
go build -o bin/tinyengine cmd/tinyengine/main.go

# ビルド成果物のクリーンアップ
rm -rf bin/ coverage.out
```

## アーキテクチャ概要

プロジェクトは以下のコアシステムからなるモジュラーなゲームエンジンアーキテクチャに従います：

### コアシステム
- **エンジンコア** (`internal/core/`): メインゲームループ、アプリケーションライフサイクル、デルタタイム管理
- **シーンシステム** (`internal/scene/`): シーン管理、アクター階層、GameObjectインターフェース
- **レンダラー** (`internal/renderer/`): OpenGL抽象化、バッチレンダリング、シェーダー管理
- **入力システム** (`internal/input/`): キーボード・マウス入力、イベント処理、入力マッピング
- **オーディオシステム** (`internal/audio/`): サウンド・音楽再生、音量制御
- **UIシステム** (`internal/ui/`): 基本UI要素（ボタン、ラベル、パネル）、レイアウト管理
- **カメラシステム** (`internal/camera/`): 2Dカメラ、ビューポート管理、座標変換
- **衝突判定システム** (`internal/collision/`): AABB（軸平行境界ボックス）と円形衝突判定
- **数学ライブラリ** (`internal/math/`): ベクトル、行列、変換ユーティリティ
- **プラットフォーム層** (`internal/platform/`): ウィンドウ管理、タイミング

### コアインターフェース設計

すべてのゲームオブジェクトは以下の基本インターフェースを実装します：

```go
type GameObject interface {
    Initialize() error
    Update(deltaTime float64)
    Render(renderer Renderer)
    Destroy()
}
```

## テスト駆動開発（TDD）

プロジェクトは厳密にTDD手法に従います：

1. **Red**: 失敗するテストを最初に書く
2. **Green**: テストを通すための最小限のコードを実装
3. **Refactor**: コードをクリーンに改善

### テスト分類
- **単体テスト**: 個々のコンポーネントのテスト
- **統合テスト**: システム相互作用のテスト
- **エンドツーエンドテスト**: 完全なゲームループのテスト

目標テストカバレッジ: 80%以上

## SOLID原則の適用

- **SRP（単一責任原則）**: 各クラスは単一の責任を持つ（例：Rendererは描画のみ処理）
- **OCP（オープン・クローズド原則）**: インターフェースベースの拡張（新しいレンダリングバックエンドの追加が容易）
- **LSP（リスコフの置換原則）**: すべてのGameObject実装は互換性がある
- **ISP（インターフェース分離原則）**: 小さく特化したインターフェース
- **DIP（依存性逆転原則）**: 抽象に依存し、実装に依存しない

## 実装フェーズ

プロジェクトは段階的な実装のために設計されています：

1. **フェーズ1**（1-2週目）: 基盤システム、コアインターフェース、エンジンコア
2. **フェーズ2**（3-4週目）: OpenGLレンダラー、基本図形、シェーダー
3. **フェーズ3**（5週目）: 入力システム
4. **フェーズ4**（6週目）: アセット管理、テクスチャ、フォント
5. **フェーズ5**（7週目）: オーディオシステム
6. **フェーズ6**（8週目）: UIシステム
7. **フェーズ7**（9週目）: カメラシステム
8. **フェーズ8**（10週目）: 衝突判定
9. **フェーズ9**（11-12週目）: 統合・最適化

## 教育リソース

`/books/` ディレクトリには段階的な実装ガイドが含まれています：
- 各章は理論、設計、実装、基本原理をカバー
- ガイドはゼロからの完全なエンジン再構築を可能にする構造
- 実装と基本的なコンピュータグラフィックス概念の理解に焦点

### 教育ガイドブックの章構成

1. **01-getting-started.md**: Go環境セットアップ、OpenGL/GLFW設定、基本ウィンドウ表示
2. **02-engine-architecture.md**: ゲームエンジンの基本概念、ゲームループ、エンジンコア実装
3. **03-rendering-system.md**: 描画システム基礎、OpenGL座標系、シェーダー概念
4. **04-math-system.md**: ゲーム数学基礎、ベクトル演算、行列変換
5. **05-scene-system.md**: シーンとアクター概念、オブジェクト管理システム
6. **06-input-system.md**: 入力処理基本、イベントドリブンvs状態ベース
7. **07-texture-sprite-system.md**: テクスチャとスプライト概念、画像読み込み・描画
8. **08-text-rendering.md**: フォントレンダリング仕組み、文字描画システム
9. **09-audio-system.md**: デジタルオーディオ基礎、サウンド再生・ミキシング
10. **10-ui-system.md**: ゲームUI設計原則、イベント処理・レイアウト
11. **11-camera-system.md**: カメラ概念・座標変換、ビューポート・プロジェクション
12. **12-collision-system.md**: 衝突判定アルゴリズム、空間分割基礎
13. **13-complete-game.md**: 全システム統合ゲーム作成、パフォーマンス最適化

## コード品質基準

- **サイクロマティック複雑度**: 関数あたり最大10
- **ドキュメント**: Godoc形式、使用例付き
- **リント**: golangci-lint準拠
- **テスト**: 包括的な単体、統合、E2Eテストカバレッジ
- **テストカバレッジ目標**: 80%以上

## プロジェクト構造

コードベースは標準的なGoプロジェクトレイアウトに従います：
- `cmd/`: アプリケーションエントリーポイント
- `internal/`: プライベートアプリケーションコード
- `pkg/`: 公開ライブラリインターフェース
- `test/`: テストフィクスチャとヘルパー
- `assets/`: ゲームアセット（シェーダー、テクスチャ、サウンド、フォント）
- `examples/`: サンプルゲーム（basic、platformer、pong）
- `books/`: 教育実装ガイド

## CI/CDパイプライン

プロジェクトは以下のCI/CD設定を使用予定：

```yaml
# .github/workflows/ci.yml
name: CI
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-go@v3
        with:
          go-version: '1.19'
      - run: make test
      - run: make lint
```

## 拡張可能性

### プラグインアーキテクチャ
- インターフェースベースの拡張
- 外部レンダリングバックエンド対応
- カスタムコンポーネント追加

### 将来の拡張予定
- 3D描画サポート
- ネットワーク機能
- 物理エンジン統合
- スクリプト言語組み込み

## 成功指標

### 技術指標
- 全機能が仕様通り動作
- テストカバレッジ80%以上
- クリーンなアーキテクチャ

### 教育指標
- ガイドブックに従ってエンジンを再実装可能
- サンプルゲームが動作
- 基本的なゲーム開発概念の理解
- Go言語でのソフトウェア設計スキル向上